---
layout:     post
title:      ç»Ÿä¸€æ­¢ç›ˆæ­¢æŸå°è£…æ–¹æ¡ˆï¼šOKã€ç«å¸ã€å¸å®‰ä¸‰æ‰€é€šç”¨ç±»åº“
date:       2025-09-05
header-img: img/post-bg-desk.jpg
catalog: true
---

é‡‘èå¸‚åœºç¬æ¯ä¸‡å˜ï¼Œæƒ³åœ¨åˆçº¦äº¤æ˜“ä¸­**ä¸»åŠ¨æ­¢ç›ˆ**ã€**åŠæ—¶æ­¢æŸ**ï¼Œå´è‹¦äºå„äº¤æ˜“æ‰€æ¥å£ä¸åŒï¼Ÿè¿™ä»½ç¼ºçœæ¨¡å—ä¸“ä¸º FMZ é‡åŒ–å¹³å°æ‰“é€ ï¼Œé€šè¿‡ Python ç±»åº“ä¸€æ¬¡æ€§è§£å†³ **OKï¼ˆæ¬§æ˜“ï¼‰ã€ç«å¸ã€å¸å®‰** ä¸‰å¤§æ‰€çš„æ­¢ç›ˆæ­¢æŸå·®å¼‚ï¼Œé™ä½é£é™©ã€èŠ‚çœæ‰‹ç»­è´¹ï¼Œå¼€å‘è€…å³å¯ä¸“æ³¨ç­–ç•¥æœ¬èº«ã€‚

---

## ä¸ºä»€ä¹ˆéœ€è¦ä¸“é—¨çš„æ­¢ç›ˆæ­¢æŸå°è£…ï¼Ÿ
- èŠ‚çœæ‰‹ç»­è´¹ï¼šé™ä»·æ­¢ç›ˆæ­¢æŸé¿å…å¸‚ä»·æ»‘ç‚¹ã€‚  
- ç»Ÿä¸€æ¥å£ï¼šé€ä»“/å…¨ä»“ã€U æœ¬ä½/å¸æœ¬ä½å…¨éƒ¨æ”¯æŒã€‚  
- é˜²æ­¢çˆ†ä»“ï¼šæç«¯è¡Œæƒ…ä¸­æå‰è§¦å‘æ­¢æŸï¼Œææ—©ä¸Šé”äºæŸã€‚  

ğŸ‘‰ [ç«‹å³ä¸€é”®ä½“éªŒå®æ—¶é£æ§æ¨¡å—ï¼Œé¿å…é”™è¿‡å…³é”®è¡Œæƒ…ï¼](https://okxdog.com/)

---

## æ ¸å¿ƒå…³é”®è¯  
æ­¢ç›ˆæ­¢æŸã€åˆçº¦äº¤æ˜“ã€é€ä»“ã€å…¨ä»“ã€å¸æœ¬ä½ã€U æœ¬ä½ã€Python å°è£…ã€OKXã€ç«å¸ã€å¸å®‰

---

## æ–¹æ³•ä¸€ï¼šä½¿ç”¨åœºæ™¯æ‹†è§£

| åœºæ™¯ | åŸç”Ÿæ¥å£å·®å¼‚ | å°è£…åçš„ä¼˜åŠ¿ |
|---|---|---|
| é€ä»“æ¨¡å¼å°é¢è¯•ä»“ | OK éœ€ç‹¬ç«‹å­—æ®µæŒ‡å®šæ­¢ç›ˆæ­¢æŸ | åŒä¸€è¡Œå‚æ•°å³å¯è°ƒç”¨ |
| å…¨ä»“æ¨¡å¼å¯»æ±‚æ æ†æ•ˆç‡ | ç«å¸ URLã€å‚æ•°å¤šå˜ | ç»Ÿä¸€æˆ `cangType=1` |
| åšå¤š/åšç©ºåŒä¾§æŒ‚å• | å¸å®‰é¡»åˆ†å¼€ `STOP`ã€`TAKE_PROFIT` | ä¸€è¡Œä»£ç æ‰¹é‡ä¸‹å‘ |

---

## æ–¹æ³•äºŒï¼šå®Œæ•´æºç ï¼ˆå¼€æºï¼‰

```python
import json
import time

# === 1. ä¸»å…¥å£ ===
def zhiyingzhisun(ex, amount, directionStr, zhiying_price, zhisun_price, cangType=0):
    """
    ä¸‰å¤§æ‰€é€šç”¨æ­¢ç›ˆæ­¢æŸ
    :param ex: FMZ exchange
    :param amount: å§”æ‰˜æ•°é‡
    :param directionStr: 'buy' or 'sell'
    :param zhiying_price: æ­¢ç›ˆè§¦å‘ä»·ï¼ˆé™ä»·ï¼‰
    :param zhisun_price: æ­¢æŸè§¦å‘ä»·ï¼ˆé™ä»·ï¼‰
    :param cangType: 0 é€ä»“ 1 å…¨ä»“
    :return: True/False
    """
    name = ex.GetName()
    if 'OK' in name:
        return okexSwap(ex, amount, directionStr, zhiying_price, zhisun_price)
    if 'Huobi' in name:
        return huobiSwap(ex, amount, directionStr, zhiying_price, zhisun_price, cangType)
    if 'Binance' in name:
        return binanceSwap(ex, amount, directionStr, zhiying_price, zhisun_price)
    return False

# === 2. ç»Ÿä¸€å¼‚æ­¥è¯·æ±‚ ===
def AsynIo(ex, paramList):
    """
    FMZ çš„ Go è¯­æ³•å°è£…
    """
    arrRoutine = ex.Go("IO", *paramList)
    data, ok = arrRoutine.wait()
    return data

# === 3. ç«å¸ä¸“å± ===
def huobiSwap(ex, amount, directionStr, zhiying_price, zhisun_price, cangType):
    instrument_id = ex.GetCurrency().replace('_', '-')
    usdt_type = 'USDT' in instrument_id
    
    # é€‰æ‹© URL
    if usdt_type and cangType == 0:
        url = "/linear-swap-api/v1/swap_tpsl_order"
    elif usdt_type and cangType == 1:
        url = "/linear-swap-api/v1/swap_cross_tpsl_order"
    elif not usdt_type:
        url = "/swap-api/v1/swap_tpsl_order"
    else:
        return False

    payload = {
        "contract_code": instrument_id,
        "direction": directionStr,
        "volume": str(amount),
        "tp_order_price": str(zhiying_price),
        "tp_trigger_price": str(zhiying_price),
        "sl_trigger_price": str(zhisun_price),
        "sl_order_price": str(zhisun_price),
    }
    res = AsynIo(ex, ['api', 'POST', url, '', json.dumps(payload)])
    return res.get("status") == "ok"

# === 4. å¸å®‰ä¸“å± ===
def binanceSwap(ex, amount, directionStr, zhiying_price, zhisun_price):
    instrument_id = ex.GetCurrency().replace('_', '')
    url = "/fapi/v1/order" if 'USDT' in instrument_id else "/dapi/v1/order"
    ts = str(int(time.time()*1000))
    
    # æ­¢æŸ
    sl_param = {
        "symbol": instrument_id,
        "side": directionStr.upper(),
        "type": "STOP",
        "quantity": str(amount),
        "price": str(zhisun_price),
        "stopPrice": str(zhisun_price),
        "timestamp": ts
    }
    sl_data = AsynIo(ex, ["api", "POST", url, "", json.dumps(sl_param)])
    if int(sl_data.get("stopPrice", 0)) != int(zhisun_price):
        return False

    # æ­¢ç›ˆ
    tp_param = {
        "symbol": instrument_id,
        "side": directionStr.upper(),
        "type": "TAKE_PROFIT",
        "quantity": str(amount),
        "price": str(zhiying_price),
        "stopPrice": str(zhiying_price),
        "timestamp": ts
    }
    tp_data = AsynIo(ex, ["api", "POST", url, "", json.dumps(tp_param)])
    return int(tp_data.get("stopPrice", 0)) == int(zhiying_price)

# === 5. OK ä¸“å± ===
def okexSwap(ex, amount, directionStr, zhiying_price, zhisun_price):
    instrument_id = ex.GetCurrency().replace('_', '-') + "-SWAP"
    direction_code = "4" if directionStr == "buy" else "3"
    payload = {
        "instrument_id": instrument_id,
        "type": direction_code,
        "order_type": "5",  # 5 = æ­¢ç›ˆæ­¢æŸå§”æ‰˜
        "size": str(amount),
        "tp_trigger_price": str(zhiying_price),
        "tp_price": str(zhiying_price),
        "sl_trigger_price": str(zhisun_price),
        "sl_price": str(zhisun_price)
    }
    res = AsynIo(ex, ["api", "POST", "/v1/order/orders/place", "", json.dumps(payload)])
    return res.get("error_code") == "0"

# === FMZ æ’ä»¶å¯¼å‡º ===
ext.zhiyingzhisun = zhiyingzhisun
```

---

## æ–¹æ³•ä¸‰ï¼šé›†æˆåˆ°ç°æœ‰ç­–ç•¥ï¼ˆç¤ºä¾‹ï¼‰

å‡è®¾ä½ å·²æœ‰ä¸€æ¡è·Ÿéšè¶‹åŠ¿çš„ç­–ç•¥æœºå™¨äººï¼Œå¯åœ¨å…³é”®å…¥åœºå¤„æ·»åŠ ä¸¤è¡Œä»£ç ï¼š

```python
# å…ˆä¸‹å•
exchange.SetDirection("buy")
id = exchange.Buy(price, amount)

# ç«‹å³æŒ‚æ­¢ç›ˆæ­¢æŸ
ext.zhiyingzhisun(exchange, amount, "buy", tp_price, sl_price, cangType=1)
```
ğŸ‘‰ [å¿«é€Ÿæå‡ç­–ç•¥ç¨³å®šæ€§ï¼Œé˜²æ­¢é»‘å¤©é¹…ï¼Ÿä¸€åˆ†é’Ÿè¯•é€šæ­¢ç›ˆæ­¢æŸå®æˆ˜ï¼](https://okxdog.com/)

---

## FAQï¼šå¸¸è§ç–‘é—®ä¸€æ¬¡è®²æ¸…

**Q1ï¼šå¦‚ä½•ç¡®è®¤æ­¢ç›ˆæ­¢æŸæ˜¯å¦çœŸçš„æŒ‚åˆ°äº¤æ˜“æ‰€ï¼Ÿ**  
Aï¼šä½ å¯ä»¥åœ¨å›è°ƒä¸­å†æ¬¡æŸ¥è¯¢è®¢å•åˆ—è¡¨ï¼›ç«å¸ä¸ OK ä¹Ÿæ”¯æŒè·å–â€œæ­¢ç›ˆæ­¢æŸå§”æ‰˜åˆ—è¡¨â€ï¼Œç”¨ç»Ÿä¸€æ¥å£å³å¯æ ¸å®æˆäº¤çŠ¶æ€ã€‚

**Q2ï¼šå¸å®‰è¿”å› `-1022` ç­¾åé”™è¯¯æ€ä¹ˆåŠï¼Ÿ**  
Aï¼šæ£€æŸ¥ API key çš„æƒé™ï¼Œåˆçº¦éœ€å¼€å¯ `Delivery` æˆ– `Futures`ï¼Œå¦å¤–ç¡®ä¿å·²ç»å®Œæˆç™½åå•ç»‘å®šã€‚

**Q3ï¼šé€ä»“æ¨¡å¼ä¸‹æ˜¯å¦å¯ä»¥å•ç‹¬ç»™å…¥é‡‘è´¦æˆ·åŠ ä¿è¯é‡‘ï¼Ÿ**  
Aï¼šä¸è¡Œï¼Œè¯¥ç±»åº“ä»…è´Ÿè´£å§”æ‰˜é€»è¾‘ï¼Œå¦‚éœ€è¿½åŠ ä¿è¯é‡‘éœ€å†ç”¨ `POST /fapi/v1/positionMargin`ï¼ˆå¸å®‰ï¼‰ç­‰æ¥å£ã€‚

**Q4ï¼šåœ¨å›æµ‹ç¯å¢ƒé‡Œèƒ½å¦ä½¿ç”¨ï¼Ÿ**  
Aï¼šå›æµ‹ç¯å¢ƒå¹¶ä¸å¯¹æ¥çœŸå®äº¤æ˜“æ‰€ï¼Œæ­¢ç›ˆæ­¢æŸå…ˆéšè—ä¸ºè™šæ‹Ÿé€»è¾‘ï¼Œä¸Šçº¿å‰è®°å¾—è½¬çœŸå®ç¯å¢ƒéªŒè¯ã€‚

**Q5ï¼šå¦‚ä½•æ‰¹é‡æ’¤é”€æ­¢ç›ˆæ­¢æŸï¼Ÿ**  
Aï¼šæ ¹æ®å„è‡ªäº¤æ˜“æ‰€çš„è§„åˆ™ï¼Œå…ˆè°ƒç”¨æŸ¥è¯¢æ¥å£å¾—åˆ°ç›¸åº”çš„ `orderId`ï¼Œå†æ‰¹é‡å‘é€å–æ¶ˆå³å¯ã€‚

**Q6ï¼šæ­¢ç›ˆä»·å’Œæ­¢æŸä»·å¯å¦è®¾ç½®æˆå¸‚ä»·è§¦å‘ï¼Ÿ**  
Aï¼šä¸ºäº†å…¼é¡¾æ‰‹ç»­è´¹ï¼Œæœ¬ç±»åº“ç»Ÿä¸€ä½¿ç”¨é™ä»·ï¼›éœ€è¦å¸‚ä»·è§¦å‘ï¼Œå¯ç›´æ¥åœ¨è¯·æ±‚ä½“å†…æŠŠ `price` æ”¹æˆäº¤æ˜“æ‰€å…è®¸çš„æç«¯å€¼ï¼Œä½†è¯·è°¨æ…è¯„ä¼°æ»‘ç‚¹é£é™©ã€‚

---

## ç»“è¯­

é€šè¿‡æœ¬æ–‡çš„å®Œæ•´å°è£…ï¼Œä»»ä½• Python é‡åŒ–çˆ±å¥½è€…éƒ½èƒ½åœ¨ **åˆ†é’Ÿçº§** å†…ä¸ºè‡ªå·±çš„ç­–ç•¥å¢æ•ˆï¼š  
- æ‘†è„±æ¥å£å·®å¼‚ï¼Œå®‰å…¨ç»Ÿä¸€æ­¢ç›ˆæ­¢æŸ  
- é™ä½æˆæœ¬ï¼Œæé«˜é£é™©åœºæ™¯ä¸‹çš„å­˜æ´»ç‡  
- ä»£ç å¼€æºï¼Œå¯éšä¸šåŠ¡çµæ´»æ”¹å†™

èµ¶ç´§æŠŠè¿™æ®µå…¬å…±æ¨¡å—åµŒå…¥ä½ çš„äº¤æ˜“æœºå™¨äººï¼Œè®©æ¯ä¸€æ¬¡å¼€ä»“èƒŒåéƒ½æ‹¥æœ‰ä¸“ä¸šçº§é£æ§ï¼